<!DOCTYPE html>
<html>
<head>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.0.0/dist/tf.min.js"></script>
</head>
<body>

<div id='input'><input id="prompt" autocomplete="off"></div>
<div id="test"></div>


<script>
async function init() {
    	encoder = await tf.loadLayersModel('https://gippoo.github.io/chatbot/encoder/model.json');
	decoder = await tf.loadLayersModel('https://gippoo.github.io/chatbot/decoder/model.json');
}
	
init();
	
var prompt_char_to_ix = {'y': 0,
 '[': 1,
 '2': 2,
 'v': 3,
 'h': 4,
 'r': 5,
 ')': 6,
 "'": 7,
 'j': 8,
 '1': 9,
 '3': 10,
 ',': 11,
 '4': 12,
 'n': 13,
 'm': 14,
 '8': 15,
 'w': 16,
 '(': 17,
 'g': 18,
 '7': 19,
 '#': 20,
 'a': 21,
 '.': 22,
 ':': 23,
 'x': 24,
 'e': 25,
 'u': 26,
 '5': 27,
 'q': 28,
 'b': 29,
 '&': 30,
 'f': 31,
 '!': 32,
 'c': 33,
 'i': 34,
 '0': 35,
 't': 36,
 'l': 37,
 '"': 38,
 '-': 39,
 'p': 40,
 '6': 41,
 '$': 42,
 'z': 43,
 '9': 44,
 ']': 45,
 '?': 46,
 ' ': 47,
 'd': 48,
 's': 49,
 'k': 50,
 'o': 51}
 
 var prompt_ix_to_char = {0: 'y',
 1: '[',
 2: '2',
 3: 'v',
 4: 'h',
 5: 'r',
 6: ')',
 7: "'",
 8: 'j',
 9: '1',
 10: '3',
 11: ',',
 12: '4',
 13: 'n',
 14: 'm',
 15: '8',
 16: 'w',
 17: '(',
 18: 'g',
 19: '7',
 20: '#',
 21: 'a',
 22: '.',
 23: ':',
 24: 'x',
 25: 'e',
 26: 'u',
 27: '5',
 28: 'q',
 29: 'b',
 30: '&',
 31: 'f',
 32: '!',
 33: 'c',
 34: 'i',
 35: '0',
 36: 't',
 37: 'l',
 38: '"',
 39: '-',
 40: 'p',
 41: '6',
 42: '$',
 43: 'z',
 44: '9',
 45: ']',
 46: '?',
 47: ' ',
 48: 'd',
 49: 's',
 50: 'k',
 51: 'o'}
 
 var reply_char_to_ix = {'y': 0,
 '[': 1,
 '2': 2,
 'v': 3,
 'h': 4,
 'r': 5,
 ')': 6,
 "'": 7,
 'j': 8,
 '1': 9,
 '\t': 10,
 ',': 11,
 '4': 12,
 'n': 13,
 'm': 14,
 '8': 15,
 'w': 16,
 '7': 17,
 'g': 18,
 '(': 19,
 'a': 20,
 '.': 21,
 ':': 22,
 'x': 23,
 'e': 24,
 'u': 25,
 '5': 26,
 'q': 27,
 'b': 28,
 '&': 29,
 'f': 30,
 '!': 31,
 'c': 32,
 'i': 33,
 '0': 34,
 't': 35,
 'l': 36,
 'p': 37,
 '-': 38,
 '"': 39,
 '6': 40,
 'z': 41,
 '9': 42,
 ']': 43,
 '?': 44,
 ' ': 45,
 'd': 46,
 's': 47,
 '\n': 48,
 'k': 49,
 'o': 50}
 
 var reply_ix_to_char = {0: 'y',
 1: '[',
 2: '2',
 3: 'v',
 4: 'h',
 5: 'r',
 6: ')',
 7: "'",
 8: 'j',
 9: '1',
 10: '\t',
 11: ',',
 12: '4',
 13: 'n',
 14: 'm',
 15: '8',
 16: 'w',
 17: '7',
 18: 'g',
 19: '(',
 20: 'a',
 21: '.',
 22: ':',
 23: 'x',
 24: 'e',
 25: 'u',
 26: '5',
 27: 'q',
 28: 'b',
 29: '&',
 30: 'f',
 31: '!',
 32: 'c',
 33: 'i',
 34: '0',
 35: 't',
 36: 'l',
 37: 'p',
 38: '-',
 39: '"',
 40: '6',
 41: 'z',
 42: '9',
 43: ']',
 44: '?',
 45: ' ',
 46: 'd',
 47: 's',
 48: '\n',
 49: 'k',
 50: 'o'}

function change_div() {
	let prompt = document.getElementById("prompt").value;
    console.log(prompt);
    
    let prompt_vec = [];
    
    for (let i=0; i<prompt.length; i++) {
    	prompt_vec.push(prompt_char_to_ix[prompt[i]])
    }
    while (prompt_vec.length < 89) {
    	prompt_vec.push(52);
    }
    console.log(prompt_vec);
    
    let one_hot = tf.oneHot(tf.tensor1d(prompt_vec, 'int32'), 52);

    
    one_hot.print();
    
    let states_value = encoder.predict(one_hot);
	
    console.log(states_value);
    
    document.getElementById("test").innerHTML += prompt;
    document.getElementById("test").innerHTML += '<br>';
    document.getElementById("prompt").value = '';

}

const node = document.getElementById("prompt");
node.addEventListener("keyup", function(event) {
    if (event.key === "Enter") {
        change_div();
    }
});

</script>
</body>
</html>
